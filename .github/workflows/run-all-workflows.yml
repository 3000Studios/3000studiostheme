name: ğŸš€ Run All Workflows

on:
  workflow_dispatch:
    inputs:
      workflows_to_run:
        description: 'Select workflows to run (comma-separated or "all")'
        required: false
        default: 'all'
        type: string

permissions:
  actions: write
  contents: read

jobs:
  trigger-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ”¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ¯ Trigger All Workflows
        env:
          GH_TOKEN: ${{ secrets.GITHUB_PAT }}
          WORKFLOWS_INPUT: ${{ github.event.inputs.workflows_to_run }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸš€ 3000 Studios - Running All Workflows"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          # List of all workflows that support workflow_dispatch
          WORKFLOWS=(
            "auto-changelog.yml"
            "auto-deploy.yml"
            "command-center-sync.yml"
            "deploy-wordpress-theme.yml"
            "deploy-wordpress.yml"
            "dev-inspector.yml"
            "drive-sync.yml"
            "github_workflows_auto-approve-and-merge_Version5.yml"
            "nightly-backup.yml"
            "repo-optimizer.yml"
            "security-watchdog.yml"
            "theme-package.yml"
          )
          
          # Determine which workflows to run
          if [ "$WORKFLOWS_INPUT" = "all" ] || [ -z "$WORKFLOWS_INPUT" ]; then
            SELECTED_WORKFLOWS=("${WORKFLOWS[@]}")
          else
            IFS=',' read -ra SELECTED_WORKFLOWS <<< "$WORKFLOWS_INPUT"
          fi
          
          echo "ğŸ“‹ Workflows to trigger:"
          printf '   â€¢ %s\n' "${SELECTED_WORKFLOWS[@]}"
          echo ""
          
          # Trigger each workflow
          SUCCESS_COUNT=0
          FAIL_COUNT=0
          
          for workflow in "${SELECTED_WORKFLOWS[@]}"; do
            # Trim whitespace
            workflow=$(echo "$workflow" | xargs)
            
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "âš¡ Triggering: $workflow"
            
            if gh workflow run "$workflow" --repo 3000Studios/3000studiostheme; then
              echo "âœ… Successfully triggered: $workflow"
              ((SUCCESS_COUNT++))
            else
              echo "âŒ Failed to trigger: $workflow"
              ((FAIL_COUNT++))
            fi
            
            # Small delay to avoid rate limiting
            sleep 2
          done
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“Š Summary:"
          echo "   âœ… Successful: $SUCCESS_COUNT"
          echo "   âŒ Failed: $FAIL_COUNT"
          echo "   ğŸ“ Total: $((SUCCESS_COUNT + FAIL_COUNT))"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # Create job summary
          echo "## ğŸš€ Workflow Trigger Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Total Workflows Triggered:** $((SUCCESS_COUNT + FAIL_COUNT))" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Successful: $SUCCESS_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "- âŒ Failed: $FAIL_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Workflows Triggered:" >> $GITHUB_STEP_SUMMARY
          for workflow in "${SELECTED_WORKFLOWS[@]}"; do
            workflow=$(echo "$workflow" | xargs)
            echo "- \`$workflow\`" >> $GITHUB_STEP_SUMMARY
          done
          
          # Exit with error if any failed
          if [ $FAIL_COUNT -gt 0 ]; then
            exit 1
          fi
      
      - name: ğŸ“‹ List Recent Workflow Runs
        if: always()
        env:
          GH_TOKEN: ${{ secrets.GITHUB_PAT }}
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“‹ Recent Workflow Runs (Last 5):"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          gh run list --repo 3000Studios/3000studiostheme --limit 5
          echo ""
      
      - name: âœ… Completion
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… All workflows triggered successfully!"
          echo "ğŸŒ Check status at: https://github.com/3000Studios/3000studiostheme/actions"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
