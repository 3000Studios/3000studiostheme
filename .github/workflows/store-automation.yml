# Copyright (c) 2025 Mr. jwswain - 3000 Studios. All Rights Reserved.
# Store Automation - Auto-products and payment integration

name: ğŸ›’ Store Automation

on:
  workflow_dispatch:
  schedule:
    # Run weekly on Sundays at midnight
    - cron: '0 0 * * 0'

env:
  THEME_NAME: 3000studios

jobs:
  store-health-check:
    name: ğŸª Store Health Check
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: ğŸ”¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ“Š Check Store Pages
        run: |
          echo "ğŸ›’ Checking store pages..."
          
          if [ -f "page-shop.php" ]; then
            echo "âœ… Shop page found"
          else
            echo "âŒ Shop page missing"
          fi
          
          if [ -f "page-app-store.php" ]; then
            echo "âœ… App Store page found"
          else
            echo "âŒ App Store page missing"
          fi

      - name: ğŸ” Check Payment Integration
        run: |
          echo "ğŸ’³ Checking payment integrations..."
          
          # Check for Stripe integration
          grep -r "stripe" --include="*.php" . && echo "âœ… Stripe integration found" || echo "â„¹ï¸  Stripe not integrated"
          
          # Check for PayPal integration
          grep -r "paypal" --include="*.php" . && echo "âœ… PayPal integration found" || echo "â„¹ï¸  PayPal not integrated"

      - name: ğŸ“ Check WooCommerce Integration
        run: |
          echo "ğŸ›ï¸ Checking WooCommerce support..."
          grep -r "woocommerce\|WC_Product" --include="*.php" . && echo "âœ… WooCommerce support found" || echo "â„¹ï¸  WooCommerce support needed"

  update-store-config:
    name: ğŸ”§ Update Store Configuration
    runs-on: ubuntu-latest
    needs: store-health-check
    permissions:
      contents: read
    steps:
      - name: ğŸ”¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“ Generate Store Report
        run: |
          mkdir -p reports
          cat > reports/store-status.md << 'EOF'
          # ğŸ›’ 3000 Studios Store Status
          
          **Last Updated:** $(date)
          
          ## Store Pages
          - Shop Page: âœ… Active
          - App Store: âœ… Active
          
          ## Payment Methods
          - Stripe: ğŸ”§ Configuration needed
          - PayPal: ğŸ”§ Configuration needed
          - Cash App: ğŸ”§ Configuration needed
          
          ## Required Actions
          1. Configure Stripe API keys in WordPress
          2. Set up PayPal Business account
          3. Add Cash App payment links
          
          ## Product Categories
          - Digital Downloads
          - AI Tools
          - Theme Licenses
          - Premium Features
          
          EOF

      - name: ğŸ“¤ Upload Report
        uses: actions/upload-artifact@v4
        with:
          name: store-report
          path: reports/store-status.md
          retention-days: 30

  payment-integration-check:
    name: ğŸ’° Payment Integration Check
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: ğŸ”¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ” Verify Payment Files
        run: |
          echo "ğŸ’³ Checking payment integration files..."
          
          if [ -f "includes/monetization.php" ]; then
            echo "âœ… Monetization file found"
            echo "Contents:"
            head -20 includes/monetization.php
          else
            echo "â„¹ï¸  Creating monetization file needed"
          fi

      - name: ğŸ“‹ Payment Checklist
        run: |
          cat << 'EOF'
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ğŸ’° PAYMENT INTEGRATION CHECKLIST
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          ## Stripe Setup
          â–¡ Create Stripe account
          â–¡ Get API keys (publishable & secret)
          â–¡ Add to WordPress settings
          â–¡ Test webhook endpoints
          
          ## PayPal Setup
          â–¡ Create PayPal Business account
          â–¡ Get API credentials
          â–¡ Configure payment buttons
          â–¡ Test transactions
          
          ## Cash App Setup
          â–¡ Get Cash App $Cashtag
          â–¡ Create payment links
          â–¡ Add to checkout page
          
          ## Security
          â–¡ Store API keys in .env
          â–¡ Never commit credentials
          â–¡ Use WordPress secrets management
          â–¡ Enable SSL/HTTPS
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          EOF
